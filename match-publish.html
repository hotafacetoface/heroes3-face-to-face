<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –º–∞—Ç—á ‚Äî –õ–∏—Ü–æ–º –∫ –ª–∏—Ü—É</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    body { background: url('https://iili.io/KGogCiP.gif') no-repeat center center fixed; background-size: cover; }
    h1 {
      text-align: center;
      margin: 20px 0;
      color: #ffdd55;
      font-size: 0.9rem;
      text-shadow: 1px 1px 2px #000;
    }
    form {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(0,15,50,0.6);
      border: 2px solid #6e4f1a;
      border-radius: 8px;
      padding: 20px 25px;
      color: #e0d0a0;
    }
    fieldset {
      border: 1px solid #b08030;
      border-radius: 6px;
      margin-bottom: 18px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.25);
    }
    legend {
      padding: 0 8px;
      color: #ffdd55;
      text-shadow: 1px 1px 2px #000;
    }
    label {
      display: block;
      margin-top: 10px;
      font-size: 0.7rem;
      color: #e0d0a0;
    }
    input, select, textarea {
      width: 100%;
      padding: 6px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #805020;
      background: rgba(0, 0, 0, 0.5);
      color: #ffdd88;
      font-family: 'Press Start 2P', cursive;
      font-size: 0.65rem;
    }
    .row {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* —Ä–æ–≤–Ω–æ 3 –∫–æ–ª–æ–Ω–∫–∏ */
  gap: 15px;
}
    button {
      background: linear-gradient(to right, #e0b050, #ffdd55);
      color: #000;
      font-weight: bold;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
      margin-top: 15px;
      width: 100%;
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 0 10px rgba(255, 220, 100, 0.6); }
  </style>
</head>
<body>

<div id="menu-placeholder"></div>

<h1>üó°Ô∏è –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –º–∞—Ç—á</h1>

<form id="matchForm">

  <!-- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è -->
  <fieldset style="display:none;">
    <legend>–°–∏—Å—Ç–µ–º–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</legend>
    <div class="row">
      <div>
        <label>–ü–∞—Ç—á (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)</label>
        <input type="text" id="patch" name="patch" readonly>
      </div>
      <div>
        <label>–î–∞—Ç–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)</label>
        <input type="text" id="date" name="date" readonly>
      </div>
      <div>
        <label>–ù–∏–∫ –∏–≥—Ä–æ–∫–∞</label>
        <input type="text" id="playerNick" name="playerNick" readonly>
      </div>
    </div>
  </fieldset>

  <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è -->
  <fieldset>
    <legend>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</legend>
    <div class="row">
      <div>
        <label>–†–∞–∑–Ω–∏—Ü–∞ –∑–æ–ª–æ—Ç–∞</label>
        <input type="number" name="goldDiff" min="-10000" max="10000" value="0" required>
      </div>
      <div>
        <label>–¶–≤–µ—Ç</label>
        <select name="color" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
          <option value="–ö—Ä–∞—Å–Ω—ã–π">üü• –ö—Ä–∞—Å–Ω—ã–π</option>
          <option value="–°–∏–Ω–∏–π">üü¶ –°–∏–Ω–∏–π</option>
        </select>
      </div>
      <div>
        <label>–ò—Å—Ö–æ–¥</label>
        <select name="result" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
          <option value="–ü–æ–±–µ–¥–∞">üèÜ –ü–æ–±–µ–¥–∞</option>
          <option value="–ü–æ—Ä–∞–∂–µ–Ω–∏–µ">üíÄ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ</option>
        </select>
      </div>
    </div>
  </fieldset>

  <!-- –ó–∞–º–∫–∏ –∏ –≥–µ—Ä–æ–∏ -->
  <fieldset>
    <legend>–ó–∞–º–∫–∏ –∏ –≥–µ—Ä–æ–∏</legend>
    <div class="row">
<div>
  <label>–í–∞—à –∑–∞–º–æ–∫</label>
  <div class="castle-select-wrapper">
    <div class="castle-select-display" id="castleDisplay" title="–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–æ–∫">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–æ–∫...</div>
    <input type="hidden" name="castle" id="castleInput" required>
    <div class="castle-dropdown" id="castleDropdown"></div>
  </div>
</div>

<div>
  <label>–ó–∞–º–æ–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</label>
  <div class="castle-select-wrapper">
    <div class="castle-select-display" id="enemyCastleDisplay" title="–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–æ–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–æ–∫...</div>
    <input type="hidden" name="enemyCastle" id="enemyCastleInput" required>
    <div class="castle-dropdown" id="enemyCastleDropdown"></div>
  </div>
</div>

<div>
  <label>–ù–∏–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</label>
  <input type="text" name="enemyNick" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫" required>
</div>

<div>
  <label>–í–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –≥–µ—Ä–æ–π</label>
  <input type="text" name="starter" placeholder="–ò–º—è –≥–µ—Ä–æ—è" required>
</div>

<div>
  <label>–û—Å–Ω–æ–≤–Ω–æ–π –≥–µ—Ä–æ–π –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</label>
  <input type="text" name="enemyStarter" placeholder="–ò–º—è –≥–µ—Ä–æ—è" required>
</div>

<div>
  <label>–û—Ü–µ–Ω–∏—Ç–µ –º–∞—Ç—á</label>
  <select name="reputation" required>
    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
    <option value="5">‚≠ê –û—Ç–ª–∏—á–Ω–æ</option>
    <option value="4">üëç –•–æ—Ä–æ—à–æ</option>
    <option value="3">üòê –°—Ä–µ–¥–Ω–µ</option>
    <option value="2">üëé –ü–ª–æ—Ö–æ</option>
    <option value="1">üíÄ –£–∂–∞—Å–Ω–æ</option>
  </select>
</div>

    </div>
  </fieldset>
<script src="js/icons-castles.js"></script>
<script src="js/icons-heroes.js"></script>
<script src="js/heroes-by-castle.js"></script>
<script src="js/icons-monsters.js"></script>
<script src="js/icons-guards.js"></script>

  <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
<fieldset>
  <legend>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</legend>
  <div class="row">

    <!-- –ù–∞—á–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å –∏–≥—Ä–æ–∫–∞ -->
    <div>
      <label>–ù–∞—á–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å –∏–≥—Ä–æ–∫–∞</label>
      <select name="bonusPlayer" required>
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
        <option value="–°–ª—É—á–∞–π–Ω–æ">üé≤ –°–ª—É—á–∞–π–Ω–æ</option>
        <option value="–ê—Ä—Ç–µ—Ñ–∞–∫—Ç">üó°Ô∏è –ê—Ä—Ç–µ—Ñ–∞–∫—Ç</option>
        <option value="–†–µ—Å—É—Ä—Å—ã">üíé –†–µ—Å—É—Ä—Å—ã</option>
        <option value="–ó–æ–ª–æ—Ç–æ">üí∞ –ó–æ–ª–æ—Ç–æ</option>
      </select>
    </div>

    <!-- –ù–∞—á–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞ -->
    <div>
      <label>–ù–∞—á–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞</label>
      <select name="bonusEnemy" required>
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
        <option value="–°–ª—É—á–∞–π–Ω–æ">üé≤ –°–ª—É—á–∞–π–Ω–æ</option>
        <option value="–ê—Ä—Ç–µ—Ñ–∞–∫—Ç">üó°Ô∏è –ê—Ä—Ç–µ—Ñ–∞–∫—Ç</option>
        <option value="–†–µ—Å—É—Ä—Å—ã">üíé –†–µ—Å—É—Ä—Å—ã</option>
        <option value="–ó–æ–ª–æ—Ç–æ">üí∞ –ó–æ–ª–æ—Ç–æ</option>
      </select>
    </div>

    <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π –±–æ–π -->
    <div>
      <label>–°–æ—Å—Ç–æ—è–ª—Å—è –ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–æ–π?</label>
      <select name="finalBattle" id="finalBattle" required>
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
        <option value="–î–∞">–î–∞</option>
        <option value="–ù–µ—Ç">–ù–µ—Ç</option>
      </select>
    </div>

    <!-- –ì–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª –±–æ–π -->
    <div>
      <label>–ì–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª –±–æ–π?</label>
      <select name="battlePlace" id="battlePlace" required disabled>
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
        <option value="–°–æ—é–∑–Ω–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è">–°–æ—é–∑–Ω–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è</option>
        <option value="–¶–µ–Ω—Ç—Ä">–¶–µ–Ω—Ç—Ä</option>
        <option value="–í—Ä–∞–∂–µ—Å–∫–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è">–í—Ä–∞–∂–µ—Å–∫–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è</option>
      </select>
    </div>

    <!-- –û—Å–∞–¥–∞ -->
    <div>
      <label>–û—Å–∞–¥–∞?</label>
      <select name="siege" id="siege" required disabled>
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
        <option value="–î–∞">–î–∞</option>
        <option value="–ù–µ—Ç">–ù–µ—Ç</option>
      </select>
    </div>

    <!-- –°–∏–ª—å–Ω–µ–π—à–∏–π —Å—Ç–µ–∫ –∏–≥—Ä–æ–∫–∞ -->
    <div>
      <label>–°–∏–ª—å–Ω–µ–π—à–∏–π —Å—Ç–µ–∫ –∏–≥—Ä–æ–∫–∞</label>
      <div class="monster-select-wrapper">
        <div class="monster-select-display" id="playerMonsterDisplay" title="–í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ">–í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ...</div>
        <input type="hidden" name="mainStack" id="playerMonsterInput" required>
        <div class="monster-dropdown" id="playerMonsterDropdown"></div>
      </div>
    </div>

    <!-- –°–∏–ª—å–Ω–µ–π—à–∏–π —Å—Ç–µ–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ -->
    <div>
      <label>–°–∏–ª—å–Ω–µ–π—à–∏–π —Å—Ç–µ–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</label>
      <div class="monster-select-wrapper">
        <div class="monster-select-display" id="enemyMonsterDisplay" title="–í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ">–í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ...</div>
        <input type="hidden" name="enemyStack" id="enemyMonsterInput" required>
        <div class="monster-dropdown" id="enemyMonsterDropdown"></div>
      </div>
    </div>

  </div>
</fieldset>


  <fieldset>
    <legend>–ü—Ä–æ–≥—Ä–µ—Å—Å –∏ —ç–∫–æ–Ω–æ–º–∏–∫–∞</legend>
    <div class="row">
      <div><label>–í–∑—è—Ç –≤—Ç–æ—Ä–æ–π –∑–∞–º–æ–∫?</label><select name="secondCastle"><option></option><option>–î–∞</option><option>–ù–µ—Ç</option></select></div>
      <div><label>–ö–æ–≥–¥–∞ –≤–∑—è—Ç –≤—Ç–æ—Ä–æ–π –∑–∞–º–æ–∫?</label><input type="text" name="secondCastleDate"></div>
      <div><label>–û—Ö—Ä–∞–Ω–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ?</label><input type="text" name="centerGuard"></div>
      <div><label>–£–¥–∞–ª–æ—Å—å –≤—ã–π—Ç–∏ –≤ —Ü–µ–Ω—Ç—Ä?</label><select name="centerEnter"><option></option><option>–î–∞</option><option>–ù–µ—Ç</option></select></div>
      <div><label>–ö–æ–≥–¥–∞ –≤—ã—à–µ–ª –≤ —Ü–µ–Ω—Ç—Ä?</label><input type="text" name="centerDate"></div>
      <div><label>–ü—Ä–æ–±–∏–ª –ª–∏ –æ—Ö—Ä–∞–Ω—É –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –≤—Ä–∞–≥–∞?</label><select name="enemyZone"><option></option><option>–î–∞</option><option>–ù–µ—Ç</option></select></div>
      <div><label>–ö—Ç–æ –±—ã–ª —É –≤—Ä–∞–≥–∞ –Ω–∞ –æ—Ö—Ä–∞–Ω–µ?</label><input type="text" name="enemyGuard"></div>
      <div><label>–ö–æ–Ω–µ—Ü –∏–≥—Ä—ã</label><input type="text" name="gameEnd"></div>
      <div>
  <label>–£—Ä–æ–≤–µ–Ω—å —ç–∫–æ–Ω–æ–º–∏–∫–∏</label>
  <select name="ecoLevel" required>
    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
    <option value="–£–ø—Ä–∞–≤–∞">üè† –£–ø—Ä–∞–≤–∞</option>
    <option value="–ü—Ä–µ—Ñ–µ–∫—Ç—É—Ä–∞">üèõÔ∏è –ü—Ä–µ—Ñ–µ–∫—Ç—É—Ä–∞</option>
    <option value="–ú—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç">üè¢ –ú—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç</option>
    <option value="–ö–∞–ø–∏—Ç–æ–ª–∏–π">üè¶ –ö–∞–ø–∏—Ç–æ–ª–∏–π</option>
  </select>
</div>

<div>
  <label>–£—Ä–æ–≤–µ–Ω—å –ì–ú</label>
  <select name="gmLevel" required>
    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
  </select>
</div>

    </div>
  </fieldset>

  <button type="submit">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
</form>
<script>
// –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ–ª–µ–π
document.addEventListener("DOMContentLoaded", () => {
  const patch = document.getElementById("patch");
  const date = document.getElementById("date");
  const playerNick = document.getElementById("playerNick");

  patch.value = "1.08"; // –∏–ª–∏ –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏—Ç—å fetch –∏–∑ Google Sheets
  date.value = new Date().toLocaleString("ru-RU", { day: "2-digit", month: "2-digit", year: "numeric", hour: "2-digit", minute: "2-digit" });
  playerNick.value = localStorage.getItem("authUser") || "–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω";
});

// –ó–∞–≥–ª—É—à–∫–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É
document.getElementById("matchForm").addEventListener("submit", (e) => {
  e.preventDefault();
  // === –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets ===
document.getElementById("matchForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const form = e.target;
  const formData = new FormData(form);
  const json = Object.fromEntries(formData.entries());

  try {
    const response = await fetch("https://script.google.com/macros/s/AKfycbx1wNCYhFSWfmeHbNhla7-xPzy2QGTLjtqc1aaZQZxNijg3Oe_Qq-yY_DPSBDVqtlsrNA/exec", {
      method: "POST",
      body: JSON.stringify(json),
      headers: { "Content-Type": "application/json" }
    });

    const result = await response.json();
    if (result.result === "success") {
      alert("‚úÖ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
      form.reset();
      window.scrollTo({ top: 0, behavior: "smooth" });
    } else {
      alert("‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ!");
    }
  } catch (err) {
    console.error(err);
    alert("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É. –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.");
  }
});

});
</script>

<!-- –ü–æ–¥–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é -->
<script>
fetch("menu.html")
  .then(r => r.text())
  .then(d => {
    document.getElementById("menu-placeholder").innerHTML = d;
    if (typeof initMenu === "function") initMenu();
  })
  .catch(err => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é:", err));
  // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ "–†–∞–∑–Ω–∏—Ü–∞ –∑–æ–ª–æ—Ç–∞" –ø—Ä–∏ –≤–≤–æ–¥–µ
const goldDiffInput = document.querySelector('input[name="goldDiff"]');
if (goldDiffInput) {
  goldDiffInput.addEventListener("input", () => {
    let value = parseInt(goldDiffInput.value, 10);
    if (isNaN(value)) return;
    if (value > 10000) value = 10000;
    if (value < -10000) value = -10000;
    goldDiffInput.value = value;
  });
}

// === –°–ø–∏—Å–æ–∫ –∑–∞–º–∫–æ–≤ ===
// === –°–ø–∏—Å–æ–∫ –∑–∞–º–∫–æ–≤ –∏–∑ icons-castles.js ===
// –ù–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–º–∫–æ–≤:
const castleOrder = [
  "–ó–∞–º–æ–∫",
  "–û–ø–ª–æ—Ç",
  "–ë–∞—à–Ω—è",
  "–ò–Ω—Ñ–µ—Ä–Ω–æ",
  "–ù–µ–∫—Ä–æ–ø–æ–ª–∏—Å",
  "–¢–µ–º–Ω–∏—Ü–∞",
  "–¶–∏—Ç–∞–¥–µ–ª—å",
  "–ö—Ä–µ–ø–æ—Å—Ç—å",
  "–°–æ–ø—Ä—è–∂–µ–Ω–∏–µ",
  "–ü—Ä–∏—á–∞–ª",
  "–§–∞–±—Ä–∏–∫–∞"
];

const castles = castleOrder.map(name => ({
  id: name.toLowerCase(),
  name,
  icon: castleIcons[name]
}));

const dropdown = document.getElementById('castleDropdown');
const display = document.getElementById('castleDisplay');
const input = document.getElementById('castleInput');
let selectedCastle = null; // —Ç–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∑–∞–º–æ–∫ –∏–≥—Ä–æ–∫–∞
window.selectedCastle = null;
// –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–∫–æ–Ω–æ–∫
dropdown.innerHTML = castles.map(c => `
  <div class="castle-item" data-id="${c.id}" title="${c.name}">
    <img src="${c.icon}" alt="${c.name}">
  </div>
`).join('');

// –æ—Ç–∫—Ä—ã—Ç–∏–µ / –∑–∞–∫—Ä—ã—Ç–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –ø–æ –∫–ª–∏–∫—É
display.addEventListener('click', (e) => {
  e.stopPropagation();

  // –µ—Å–ª–∏ –∫–ª–∏–∫ –ø–æ –æ—Ç–∫—Ä—ã—Ç–æ–º—É —Å–ø–∏—Å–∫—É ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–≤–µ—Ä–Ω—É—Ç—å
  if (dropdown.classList.contains('show')) {
    dropdown.classList.remove('show');
  } else {
    // –∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ dropdown'—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ–∑–∂–µ)
    document.querySelectorAll('.castle-dropdown.show').forEach(el => el.classList.remove('show'));
    dropdown.classList.add('show');
  }
});


// –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏
document.addEventListener('click', (e) => {
  if (!e.target.closest('.castle-select-wrapper')) {
    dropdown.classList.remove('show');
  }
});
// === –í–´–ë–û–† –ó–ê–ú–ö–ê –ò –ì–ï–†–û–Ø –ü–†–û–¢–ò–í–ù–ò–ö–ê + –ò–ì–†–û–ö–ê (–∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è) ===

// ------ –ü–æ–ª–µ "–í–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –≥–µ—Ä–æ–π" (–∏–≥—Ä–æ–∫) ------
const starterField = document.querySelector('input[name="starter"]');
const heroContainer = document.createElement("div");
heroContainer.classList.add("hero-dropdown");
starterField.insertAdjacentElement("afterend", heroContainer);

// –ü–æ–∫–∞–∑ –≥–µ—Ä–æ–µ–≤ 4‚Äì3‚Äì3 –ø–æ –∑–∞–º–∫—É
function showHeroesForCastle(castleName, containerEl) {
  const heroes = heroesByCastle[castleName];
  if (!heroes) return;
  const layout = [4, 3, 3];

  let html = "", i = 0;
  layout.forEach(n => {
    html += `<div class="hero-row">`;
    for (let k = 0; k < n && i < heroes.length; k++) {
      const h = heroes[i++];
      html += `
        <div class="hero-item" title="${h}" data-hero="${h}">
          <img src="${heroIcons[h] || 'https://via.placeholder.com/40'}" alt="${h}">
        </div>`;
    }
    html += `</div>`;
  });
  containerEl.innerHTML = html;
}

// ------ –í—ã–±–æ—Ä –∑–∞–º–∫–∞ –∏–≥—Ä–æ–∫–∞ (–µ–¥–∏–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫) ------
dropdown.addEventListener('click', (e) => {
  e.stopPropagation();
  const item = e.target.closest('.castle-item');
  if (!item) return;

  const castle = castles.find(c => c.id === item.dataset.id);
  if (!castle) return;

  input.value = castle.name;
  display.innerHTML = `<img src="${castle.icon}" alt="${castle.name}"> ${castle.name}`;
  dropdown.classList.remove('show');

  selectedCastle = castle.name;
  window.selectedCastle = castle.name;  // ‚úÖ –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –≤—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞
  heroContainer.classList.remove("visible");
  starterField.value = "";

});


// ------ –ö–ª–∏–∫ –ø–æ "–í–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –≥–µ—Ä–æ–π" ------
starterField.addEventListener("click", (e) => {
  e.stopPropagation();
  if (!selectedCastle) {
    alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Å–≤–æ–π –∑–∞–º–æ–∫!");
    return;
  }
  if (heroContainer.classList.contains("visible")) {
    heroContainer.classList.remove("visible");
  } else {
    showHeroesForCastle(selectedCastle, heroContainer);
    heroContainer.classList.add("visible");
  }
});

// –í—ã–±–æ—Ä –≥–µ—Ä–æ—è –∏–≥—Ä–æ–∫–∞
heroContainer.addEventListener("click", (e) => {
  const heroDiv = e.target.closest(".hero-item");
  if (!heroDiv) return;
  starterField.value = heroDiv.dataset.hero;
  heroContainer.classList.remove("visible");
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—ã–ø–∞–¥–∞—à–µ–∫ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
document.addEventListener("click", (e) => {
  if (!e.target.closest(".hero-dropdown") && !e.target.closest('input[name="starter"]')) {
    heroContainer.classList.remove("visible");
  }
});
// === –ö–ê–°–¢–û–ú–ù–´–ô –í–´–ë–û–† –ó–ê–ú–ö–ê –ü–†–û–¢–ò–í–ù–ò–ö–ê ===
const enemyDropdown = document.getElementById('enemyCastleDropdown');
const enemyDisplay = document.getElementById('enemyCastleDisplay');
const enemyInput = document.getElementById('enemyCastleInput');
let enemySelectedCastle = null; // —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

// —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å–ø–∏—Å–∫–∞ –∑–∞–º–∫–æ–≤ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
function renderEnemyCastles() {
  enemyDropdown.innerHTML = castles
    .filter(c => c.name !== selectedCastle) // –∏—Å–∫–ª—é—á–∞–µ–º –∑–∞–º–æ–∫ –∏–≥—Ä–æ–∫–∞
    .map(c => `
      <div class="castle-item" data-id="${c.id}" title="${c.name}">
        <img src="${c.icon}" alt="${c.name}">
      </div>
    `).join('');
}

// –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ –ø–æ–ª—é "–∑–∞–º–æ–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞" ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ–º/–∑–∞–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
enemyDisplay.addEventListener('click', (e) => {
  e.stopPropagation();

  // –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç ‚Äî –∑–∞–∫—Ä—ã—Ç—å
  if (enemyDropdown.classList.contains('show')) {
    enemyDropdown.classList.remove('show');
  } else {
    renderEnemyCastles(); // –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å —Å —É—á—ë—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ –≤—ã–±–æ—Ä–∞ –∏–≥—Ä–æ–∫–∞
    document.querySelectorAll('.castle-dropdown.show').forEach(el => el.classList.remove('show'));
    enemyDropdown.classList.add('show');
  }
});

// –≤—ã–±–æ—Ä –∑–∞–º–∫–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
enemyDropdown.addEventListener('click', (e) => {
  e.stopPropagation();
  const item = e.target.closest('.castle-item');
  if (!item) return;

  const castle = castles.find(c => c.id === item.dataset.id);
  if (!castle) return;

  enemyInput.value = castle.name;
  enemyDisplay.innerHTML = `<img src="${castle.icon}" alt="${castle.name}"> ${castle.name}`;
  enemyDropdown.classList.remove('show');

  enemySelectedCastle = castle.name;
  window.enemySelectedCastle = castle.name;
  enemyHeroContainer.classList.remove("visible");
  enemyStarterField.value = "";
});
// === –í–´–ë–û–† –ì–ï–†–û–Ø –ü–†–û–¢–ò–í–ù–ò–ö–ê ===
const enemyStarterField = document.querySelector('input[name="enemyStarter"]');
const enemyHeroContainer = document.createElement("div");
enemyHeroContainer.classList.add("hero-dropdown");
enemyStarterField.insertAdjacentElement("afterend", enemyHeroContainer);

// –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø–æ–ª—é "–û—Å–Ω–æ–≤–Ω–æ–π –≥–µ—Ä–æ–π –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞"
enemyStarterField.addEventListener("click", (e) => {
  e.stopPropagation();
  if (!enemySelectedCastle) {
    alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ –∑–∞–º–æ–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞!");
    return;
  }
  if (enemyHeroContainer.classList.contains("visible")) {
    enemyHeroContainer.classList.remove("visible");
  } else {
    showHeroesForCastle(enemySelectedCastle, enemyHeroContainer);
    enemyHeroContainer.classList.add("visible");
  }
});

// –≤—ã–±–æ—Ä –≥–µ—Ä–æ—è
enemyHeroContainer.addEventListener("click", (e) => {
  const heroDiv = e.target.closest(".hero-item");
  if (!heroDiv) return;
  enemyStarterField.value = heroDiv.dataset.hero;
  enemyHeroContainer.classList.remove("visible");
});

// –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏
document.addEventListener("click", (e) => {
  if (!e.target.closest(".hero-dropdown") && !e.target.closest('input[name="enemyStarter"]')) {
    enemyHeroContainer.classList.remove("visible");
  }
});

</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const finalBattleSelect  = document.getElementById('finalBattle');
  const battlePlaceSelect  = document.getElementById('battlePlace');
  const siegeSelect        = document.getElementById('siege');

  const playerMonsterDisplay  = document.getElementById('playerMonsterDisplay');
  const playerMonsterDropdown = document.getElementById('playerMonsterDropdown');
  const playerMonsterInput    = document.getElementById('playerMonsterInput');

  const enemyMonsterDisplay   = document.getElementById('enemyMonsterDisplay');
  const enemyMonsterDropdown  = document.getElementById('enemyMonsterDropdown');
  const enemyMonsterInput     = document.getElementById('enemyMonsterInput');

  // --- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –±–æ—è / –º–µ—Å—Ç–∞ / –æ—Å–∞–¥—ã
  function applyFinalDeps() {
    const isFinal = finalBattleSelect.value === '–î–∞';
    const place   = battlePlaceSelect.value;

    // –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π
    battlePlaceSelect.disabled = !isFinal;
    siegeSelect.disabled = !isFinal || place === '–¶–µ–Ω—Ç—Ä';

    // —Å–±—Ä–æ—Å, –µ—Å–ª–∏ –±–æ–π –Ω–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π
    if (!isFinal) {
      battlePlaceSelect.value = '';
      siegeSelect.value = '';
      enemyMonsterDisplay.classList.add('disabled');
      enemyMonsterDropdown.classList.remove('show');
      enemyMonsterInput.value = '';
      enemyMonsterDisplay.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ...';
    } else {
      enemyMonsterDisplay.classList.remove('disabled');
    }

    // —Å–±—Ä–æ—Å –æ—Å–∞–¥—ã, –µ—Å–ª–∏ –±–æ–π = –¶–µ–Ω—Ç—Ä
    if (place === '–¶–µ–Ω—Ç—Ä') {
      siegeSelect.value = '–ù–µ—Ç';
      siegeSelect.disabled = true;
    }
  }

  finalBattleSelect.addEventListener('change', applyFinalDeps);
  battlePlaceSelect.addEventListener('change', applyFinalDeps);
  applyFinalDeps();

  // --- –†–µ–Ω–¥–µ—Ä —Å—É—â–µ—Å—Ç–≤ –ø–æ –∑–∞–º–∫—É
  function renderMonstersByTown(town, dropdownEl) {
    if (!town) return;
    const list = Object.entries(monsterIcons)
    .filter(([_, d]) => d.town.trim().toLowerCase() === town.trim().toLowerCase());
    dropdownEl.innerHTML = list.map(([name, d]) => `
      <div class="monster-item" data-name="${name}" title="${name}">
        <img src="${d.icon}" alt="${name}">
      </div>`).join('');
    dropdownEl.classList.add('show');
  }

  // --- –ò–≥—Ä–æ–∫
  playerMonsterDisplay.addEventListener('click', (e) => {
    e.stopPropagation();
    if (!window.selectedCastle) {
      alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –∑–∞–º–æ–∫!');
      return;
    }
    renderMonstersByTown(window.selectedCastle, playerMonsterDropdown);
  });

  playerMonsterDropdown.addEventListener('click', (e) => {
    e.stopPropagation();
    const item = e.target.closest('.monster-item');
    if (!item) return;
    const name = item.dataset.name;
    playerMonsterInput.value = name;
    playerMonsterDisplay.innerHTML = `<img src="${monsterIcons[name].icon}" alt="${name}"> ${name}`;
    playerMonsterDropdown.classList.remove('show');
  });

  // --- –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫
  enemyMonsterDisplay.addEventListener('click', (e) => {
    e.stopPropagation();
    if (finalBattleSelect.value !== '–î–∞') {
      alert('–í—ã–±–æ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–æ–π –Ω–µ —Å–æ—Å—Ç–æ—è–ª—Å—è');
      return;
    }
    if (!window.enemySelectedCastle) {
      alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–æ–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞!');
      return;
    }
    renderMonstersByTown(window.enemySelectedCastle, enemyMonsterDropdown);
  });

  enemyMonsterDropdown.addEventListener('click', (e) => {
    e.stopPropagation();
    const item = e.target.closest('.monster-item');
    if (!item) return;
    const name = item.dataset.name;
    enemyMonsterInput.value = name;
    enemyMonsterDisplay.innerHTML = `<img src="${monsterIcons[name].icon}" alt="${name}"> ${name}`;
    enemyMonsterDropdown.classList.remove('show');
  });

  // --- –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –≤—ã–ø–∞–¥–∞—à–µ–∫ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.monster-select-wrapper')) {
      document.querySelectorAll('.monster-dropdown').forEach(el => el.classList.remove('show'));
    }
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  // === –ü–æ–ª–µ "–í–∑—è—Ç –≤—Ç–æ—Ä–æ–π –∑–∞–º–æ–∫?" ===
  const secondCastle = document.querySelector('select[name="secondCastle"]');
  const secondCastleDate = document.querySelector('input[name="secondCastleDate"]');
  secondCastleDate.disabled = true;

  secondCastle.addEventListener("change", () => {
    if (secondCastle.value === "–î–∞") {
      secondCastleDate.disabled = false;
    } else {
      secondCastleDate.value = "";
      secondCastleDate.disabled = true;
    }
  });

  // –ú–∞—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ "–ú–ù–î"
function validateDateInput(input) {
  input.addEventListener("input", () => {
    // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ –º–∞–∫—Å–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞
    let val = input.value.replace(/\D/g, "").slice(0, 3);
    let result = "";

    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–π —Ü–∏—Ñ—Ä–µ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
    for (let i = 0; i < val.length; i++) {
      const digit = parseInt(val[i], 10);
      if (digit === 0) continue; // –∑–∞–ø—Ä–µ—Ç –Ω—É–ª–µ–π

      if (i === 0 && digit <= 6) result += digit; // –º–µ—Å—è—Ü
      if (i === 1 && digit <= 4) result += digit; // –Ω–µ–¥–µ–ª—è
      if (i === 2 && digit <= 7) result += digit; // –¥–µ–Ω—å
    }

    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ —Ç–æ–ª—å–∫–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Ü–∏—Ñ—Ä—ã
    input.value = result;

    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª 3 —Ü–∏—Ñ—Ä—ã ‚Äî –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    if (result.length === 3) {
      const [m, w, d] = result.split("");
      input.title = `${m} –º–µ—Å—è—Ü ${w} –Ω–µ–¥–µ–ª—è ${d} –¥–µ–Ω—å`;
    } else {
      input.title = "";
    }
  });
}


  validateDateInput(secondCastleDate);

  // === –ü–æ–ª–µ "–£–¥–∞–ª–æ—Å—å –≤—ã–π—Ç–∏ –≤ —Ü–µ–Ω—Ç—Ä?" ===
  const centerEnter = document.querySelector('select[name="centerEnter"]');
  const centerDate = document.querySelector('input[name="centerDate"]');
  centerDate.disabled = true;

  centerEnter.addEventListener("change", () => {
    if (centerEnter.value === "–î–∞") {
      centerDate.disabled = false;
    } else {
      centerDate.value = "";
      centerDate.disabled = true;
    }
  });
  validateDateInput(centerDate);

  // === "–û—Ö—Ä–∞–Ω–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ" ===
const centerGuardWrapper = document.createElement("div");
centerGuardWrapper.className = "guard-select-wrapper";
const centerGuardDisplay = document.createElement("div");
centerGuardDisplay.className = "guard-select-display";
centerGuardDisplay.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ...";
const centerDropdown = document.createElement("div");
centerDropdown.className = "guard-dropdown";
centerGuardWrapper.append(centerGuardDisplay, centerDropdown);

const centerGuardInput = document.querySelector('input[name="centerGuard"]');
centerGuardInput.replaceWith(centerGuardWrapper);

centerGuardDisplay.addEventListener("click", (e) => {
  e.stopPropagation();
  const list = Object.entries(window.guardIcons);
  centerDropdown.innerHTML = list.map(([name, d]) => `
    <div class="guard-item" data-name="${name}" title="${name}">
      <img src="${d.icon}" alt="${name}">
    </div>`).join('');
  centerDropdown.classList.add("show");
});

centerDropdown.addEventListener("click", (e) => {
  const item = e.target.closest(".guard-item");
  if (!item) return;
  const name = item.dataset.name;
  centerGuardDisplay.innerHTML = `<img src="${guardIcons[name].icon}" alt="${name}"> ${name}`;
  centerDropdown.classList.remove("show");
});

// === "–ö—Ç–æ –±—ã–ª —É –≤—Ä–∞–≥–∞ –Ω–∞ –æ—Ö—Ä–∞–Ω–µ?" ===
const enemyGuardWrapper = document.createElement("div");
enemyGuardWrapper.className = "guard-select-wrapper";
const enemyGuardDisplay = document.createElement("div");
enemyGuardDisplay.className = "guard-select-display";
enemyGuardDisplay.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ...";
const enemyDropdown = document.createElement("div");
enemyDropdown.className = "guard-dropdown";
enemyGuardWrapper.append(enemyGuardDisplay, enemyDropdown);

const enemyGuardInput = document.querySelector('input[name="enemyGuard"]');
enemyGuardInput.replaceWith(enemyGuardWrapper);

enemyGuardDisplay.addEventListener("click", (e) => {
  e.stopPropagation();
  const list = Object.entries(window.guardIcons);
  enemyDropdown.innerHTML = list.map(([name, d]) => `
    <div class="guard-item" data-name="${name}" title="${name}">
      <img src="${d.icon}" alt="${name}">
    </div>`).join('');
  enemyDropdown.classList.add("show");
});

enemyDropdown.addEventListener("click", (e) => {
  const item = e.target.closest(".guard-item");
  if (!item) return;
  const name = item.dataset.name;
  enemyGuardDisplay.innerHTML = `<img src="${guardIcons[name].icon}" alt="${name}"> ${name}`;
  enemyDropdown.classList.remove("show");
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –≤—ã–ø–∞–¥–∞—à–µ–∫ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
document.addEventListener("click", (e) => {
  if (!e.target.closest(".guard-select-wrapper")) {
    document.querySelectorAll(".guard-dropdown").forEach(el => el.classList.remove("show"));
  }
});


  // === –ü–æ–ª–µ "–ö–æ–Ω–µ—Ü –∏–≥—Ä—ã" ===
  const gameEnd = document.querySelector('input[name="gameEnd"]');
  validateDateInput(gameEnd);
});
</script>


</body>
</html>
